@{
    ViewData["Title"] = "Browse Events - Eventa";
}

<!-- Page Hero -->
<section class="hero" style="padding:5rem 0;background:linear-gradient(135deg,rgba(99,102,241,0.08),rgba(139,92,246,0.08));">
    <div class="container" style="text-align:center;">
        <h1 class="section-title">All Events</h1>
        <p class="section-subtitle">Discover amazing experiences happening near you</p>
    </div>
</section>

<!-- Main Content -->
<main style="padding:4rem 0;">
    <div class="container">

        <!-- Search Bar -->
        <div style="max-width:700px;margin:0 auto 3rem;">
            <div class="hero-search">
                <input type="text" id="searchInput" placeholder="Search by event name, artist, venue, city..." autocomplete="off">
                <button id="searchButton" class="btn btn-primary">
                    Search
                </button>
            </div>
        </div>

        <!-- Category Filters -->
        <div class="category-filters" style="justify-content:center;margin-bottom:3rem;overflow-x:auto;padding-bottom:0.5rem;">
            <button class="category-filter active" data-category="all">All Events</button>
            <button class="category-filter" data-category="music">Music</button>
            <button class="category-filter" data-category="sports">Sports</button>
            <button class="category-filter" data-category="technology">Technology</button>
            <button class="category-filter" data-category="arts">Arts & Culture</button>
            <button class="category-filter" data-category="food">Food & Drink</button>
            <button class="category-filter" data-category="business">Business</button>
            <button class="category-filter" data-category="health">Health & Wellness</button>
        </div>

        <!-- Results Count -->
        <div style="text-align:center;margin-bottom:2rem;color:var(--text-secondary);font-size:1.1rem;">
            <span id="resultsCount">Loading events...</span>
        </div>

        <!-- Events Grid -->
        <div class="events-grid" id="eventsGrid">
            <div style="grid-column:1/-1;text-align:center;padding:4rem;color:#94a3b8;">
                <div class="spinner"></div>
            </div>
        </div>

        <!-- No Results Message -->
        <div id="noResults" style="display:none;grid-column:1/-1;text-align:center;padding:6rem;color:#94a3b8;">
            <h3>No events found</h3>
            <p>Try different keywords or remove filters</p>
            <button onclick="location.reload()" class="btn btn-primary" style="margin-top:1rem;">Clear Filters</button>
        </div>
    </div>
</main>

@section Scripts {
    <script>
        // === Category Page Logic (مترجمة للـ MVC تماماً) ===
        document.addEventListener('DOMContentLoaded', () => {
            const eventsGrid = document.getElementById('eventsGrid');
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.getElementById('searchButton');
            const resultsCount = document.getElementById('resultsCount');
            const noResults = document.getElementById('noResults');

            // بيانات مؤقتة لحد ما الـ API يشتغل (تماماً زي اللي كان عندك)
            const events = [
                { id: 1, title: "Summer Music Festival 2024", category: "music", date: "2025-06-15", location: "Central Park, New York", price: 89, image: "~/uploads/eventa1.jpg" },
                { id: 2, title: "Championship Finals 2025", category: "sports", date: "2025-07-20", location: "Stadium Arena, LA", price: 120, image: "~/uploads/eventa2.jpg" },
                { id: 3, title: "Global Tech Summit 2025", category: "technology", date: "2025-08-05", location: "Dubai, UAE", price: 299, image: "~/uploads/eventa3.jpg" },
                { id: 4, title: "Modern Art Exhibition", category: "arts", date: "2025-07-10", location: "Cairo Gallery", price: 50, image: "~/uploads/eventa4.jpg" },
                { id: 5, title: "Food & Wine Festival", category: "food", date: "2025-09-12", location: "Downtown", price: 75, image: "~/uploads/eventa5.jpg" },
                { id: 6, title: "Startup Networking Summit", category: "business", date: "2025-10-01", location: "Conference Center", price: 199, image: "~/uploads/eventa6.jpg" },
                { id: 7, title: "Comedy Night Live", category: "entertainment", date: "2025-05-30", location: "The Comedy Club", price: 45, image: "~/uploads/eventa7.jpg" },
                { id: 8, title: "Yoga & Wellness Retreat", category: "health", date: "2025-11-15", location: "Mountain Resort", price: 350, image: "~/uploads/eventa8.jpg" },
            ];

            let currentFilter = 'all';
            let currentSearch = '';

            // قراءة الـ Query Parameters من الـ URL
            const urlParams = new URLSearchParams(window.location.search);
            const urlCat = urlParams.get('cat');
            const urlQuery = urlParams.get('q');

            if (urlCat) {
                currentFilter = urlCat;
                const btn = document.querySelector(`[data-category="${urlCat}"]`);
                if (btn) {
                    document.querySelectorAll('.category-filter').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                }
            }
            if (urlQuery) {
                currentSearch = urlQuery;
                searchInput.value = urlQuery;
            }

            // دالة عرض الأحداث
            const renderEvents = () => {
                let filtered = events;

                if (currentSearch) {
                    const q = currentSearch.toLowerCase();
                    filtered = events.filter(e =>
                        e.title.toLowerCase().includes(q) ||
                        e.location.toLowerCase().includes(q) ||
                        e.category.toLowerCase().includes(q)
                    );
                } else if (currentFilter !== 'all') {
                    filtered = events.filter(e => e.category === currentFilter);
                }

                eventsGrid.innerHTML = '';
                resultsCount.textContent = `${filtered.length} event${filtered.length !== 1 ? 's' : ''} found`;

                if (filtered.length === 0) {
                    noResults.style.display = 'block';
                    return;
                } else {
                    noResults.style.display = 'none';
                }

                filtered.forEach((event, index) => {
                    const card = document.createElement('div');
                    card.className = 'event-card fade-in';
                    card.style.animationDelay = `${index * 0.1}s`;

                    card.innerHTML = `
                        <img src="${event.image}" alt="${event.title}" class="event-card-image" onerror="this.src='https://via.placeholder.com/400x300?text=Event+Image'">
                        <span class="event-card-badge">${event.category === 'music' ? 'Hot' : 'New'}</span>
                        <div class="event-card-content">
                            <span class="event-card-category">${event.category.charAt(0).toUpperCase() + event.category.slice(1)}</span>
                            <h3 class="event-card-title">${event.title}</h3>
                            <div class="event-card-info">
                                <div class="event-info-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3.5V12a.5.5 0 0 1-1 0V8.5H4a.5.5 0 0 1 0-1h3V4.5A.5.5 0 0 1 8 4z"/>
                                    </svg>
                                    ${new Date(event.date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' })}
                                </div>
                                <div class="event-info-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                                    </svg>
                                    ${event.location}
                                </div>
                            </div>
                            <div class="event-card-footer">
                                <div class="event-price">$${event.price}</div>
                                <a href="@Url.Action("Details", "Events", new { id = "__id__" })".replace('__id__', event.id) class="btn btn-primary btn-sm">Book Now</a>
                            </div>
                        </div>
                    `;
                    eventsGrid.appendChild(card);
                });
            };

            // أزرار الفلترة
            document.querySelectorAll('.category-filter').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.category-filter').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.category;
                    currentSearch = '';
                    searchInput.value = '';
                    const newUrl = currentFilter === 'all' ? '@Url.Action("Category", "Events")' : `@Url.Action("Category", "Events")?cat=${currentFilter}`;
                    history.pushState({}, '', newUrl);
                    renderEvents();
                });
            });

            // البحث
            const performSearch = () => {
                currentSearch = searchInput.value.trim();
                const newUrl = currentSearch ? `@Url.Action("Category", "Events")?q=${encodeURIComponent(currentSearch)}` : '@Url.Action("Category", "Events")';
                history.pushState({}, '', newUrl);
                currentFilter = 'all';
                document.querySelectorAll('.category-filter').forEach(b => b.classList.remove('active'));
                document.querySelector('[data-category="all"]').classList.add('active');
                renderEvents();
            };

            searchButton.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', e => e.key === 'Enter' && performSearch());

            // أول تشغيل
            renderEvents();
        });
    </script>
}

@section Styles {
    <style>
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
            opacity: 0;
        }
    </style>
}